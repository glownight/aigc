# ğŸ—ï¸ é¡¹ç›®æ¶æ„æ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ AIGC é¡¹ç›®çš„æŠ€æœ¯æ¶æ„ã€è®¾è®¡æ¨¡å¼å’Œæ ¸å¿ƒæ¦‚å¿µã€‚

---

## ğŸ“‹ ç›®å½•

- [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [ç›®å½•ç»“æ„](#ç›®å½•ç»“æ„)
- [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
- [æ•°æ®æµ](#æ•°æ®æµ)
- [è®¾è®¡æ¨¡å¼](#è®¾è®¡æ¨¡å¼)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [å®‰å…¨æ€§](#å®‰å…¨æ€§)

---

## ğŸ¯ æ¶æ„æ¦‚è§ˆ

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ç•Œé¢å±‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Header â”‚  â”‚Sidebar â”‚  â”‚Messagesâ”‚  â”‚Composerâ”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸šåŠ¡é€»è¾‘å±‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚useChat â”‚  â”‚useEngineâ”‚ â”‚useSessionâ”‚ â”‚useLocalâ”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®è®¿é—®å±‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚LocalStorageâ”‚  â”‚WebLLM    â”‚  â”‚Remote APIâ”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŸºç¡€è®¾æ–½å±‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚Service  â”‚  â”‚Performanceâ”‚  â”‚Error     â”‚           â”‚
â”‚  â”‚Worker   â”‚  â”‚Monitor    â”‚  â”‚Boundary  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ†å±‚æ¶æ„

#### 1. ç”¨æˆ·ç•Œé¢å±‚ (Presentation Layer)
- **èŒè´£**: æ¸²æŸ“ UIã€å¤„ç†ç”¨æˆ·äº¤äº’
- **æŠ€æœ¯**: React ç»„ä»¶ã€CSS
- **ç‰¹ç‚¹**: æ— çŠ¶æ€ã€å¯å¤ç”¨ã€æ€§èƒ½ä¼˜åŒ–

#### 2. ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer)
- **èŒè´£**: ç®¡ç†çŠ¶æ€ã€å¤„ç†ä¸šåŠ¡é€»è¾‘
- **æŠ€æœ¯**: React Hooks
- **ç‰¹ç‚¹**: å¯æµ‹è¯•ã€å¯å¤ç”¨ã€å…³æ³¨ç‚¹åˆ†ç¦»

#### 3. æ•°æ®è®¿é—®å±‚ (Data Access Layer)
- **èŒè´£**: æ•°æ®æŒä¹…åŒ–ã€API è°ƒç”¨
- **æŠ€æœ¯**: LocalStorageã€WebLLMã€Fetch API
- **ç‰¹ç‚¹**: æŠ½è±¡æ•°æ®æºã€ç»Ÿä¸€æ¥å£

#### 4. åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)
- **èŒè´£**: ç¼“å­˜ã€ç›‘æ§ã€é”™è¯¯å¤„ç†
- **æŠ€æœ¯**: Service Workerã€Performance API
- **ç‰¹ç‚¹**: æ¨ªåˆ‡å…³æ³¨ç‚¹ã€æå‡ä½“éªŒ

---

## ğŸ”§ æŠ€æœ¯æ ˆ

### å‰ç«¯æ¡†æ¶

```typescript
// React 18.3 - UI æ¡†æ¶
import React from 'react';

// TypeScript 5.6 - ç±»å‹ç³»ç»Ÿ
type User = {
  id: string;
  name: string;
};

// Vite 6.3 - æ„å»ºå·¥å…·
// å¿«é€Ÿçƒ­æ›´æ–°ã€ä¼˜åŒ–çš„ç”Ÿäº§æ„å»º
```

### æ ¸å¿ƒä¾èµ–

| ä¾èµ– | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| React | 18.3.1 | UI æ¡†æ¶ |
| TypeScript | 5.6.3 | ç±»å‹ç³»ç»Ÿ |
| Vite | 6.3.6 | æ„å»ºå·¥å…· |
| React Router | 6.28.0 | è·¯ç”±ç®¡ç† |
| WebLLM | 0.2.74 | æµè§ˆå™¨ AI å¼•æ“ |
| Framer Motion | 12.23.24 | åŠ¨ç”»åº“ |
| react-markdown | 10.1.0 | Markdown æ¸²æŸ“ |

---

## ğŸ“ ç›®å½•ç»“æ„

### å®Œæ•´ç›®å½•æ ‘

```
src/
â”œâ”€â”€ components/              # UI ç»„ä»¶
â”‚   â”œâ”€â”€ ErrorBoundary/      # é”™è¯¯è¾¹ç•Œ
â”‚   â”‚   â”œâ”€â”€ index.tsx       # ç»„ä»¶é€»è¾‘
â”‚   â”‚   â””â”€â”€ styles.css      # ç»„ä»¶æ ·å¼
â”‚   â”œâ”€â”€ ChatHeader/         # é¡¶éƒ¨å¯¼èˆªæ 
â”‚   â”œâ”€â”€ ChatSidebar/        # ä¼šè¯åˆ—è¡¨ä¾§è¾¹æ 
â”‚   â”œâ”€â”€ ChatMessages/       # æ¶ˆæ¯åˆ—è¡¨
â”‚   â”œâ”€â”€ ChatComposer/       # è¾“å…¥æ¡†
â”‚   â”œâ”€â”€ SettingsModal/      # è®¾ç½®å¼¹çª—
â”‚   â”œâ”€â”€ LockScreen/         # é”å±
â”‚   â””â”€â”€ index.ts            # ç»Ÿä¸€å¯¼å‡º
â”‚
â”œâ”€â”€ hooks/                  # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ useChat.ts          # èŠå¤©é€»è¾‘ç®¡ç†
â”‚   â”œâ”€â”€ useEngine.ts        # AI å¼•æ“ç®¡ç†
â”‚   â”œâ”€â”€ useSession.ts       # ä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ useRemoteChat.ts    # è¿œç¨‹ API ç®¡ç†
â”‚   â”œâ”€â”€ useLocalStorage.ts  # æœ¬åœ°å­˜å‚¨
â”‚   â””â”€â”€ index.ts            # ç»Ÿä¸€å¯¼å‡º
â”‚
â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ uid.ts              # ID ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ similarity.ts       # æ–‡æœ¬ç›¸ä¼¼åº¦
â”‚   â”œâ”€â”€ textQuality.ts      # æ–‡æœ¬è´¨é‡æ£€æŸ¥
â”‚   â”œâ”€â”€ webllm.ts           # WebLLM ç®¡ç†
â”‚   â”œâ”€â”€ performance.ts      # æ€§èƒ½ç›‘æ§
â”‚   â””â”€â”€ index.ts            # ç»Ÿä¸€å¯¼å‡º
â”‚
â”œâ”€â”€ types/                  # TypeScript ç±»å‹
â”‚   â””â”€â”€ index.ts            # ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ styles/                 # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ critical.css        # å…³é”® CSS
â”‚   â”œâ”€â”€ animations.css      # åŠ¨ç”»åº“
â”‚   â””â”€â”€ utilities.css       # å·¥å…·ç±»
â”‚
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ env.ts              # ç¯å¢ƒé…ç½®
â”‚
â”œâ”€â”€ App.tsx                 # ä¸»åº”ç”¨ç»„ä»¶
â”œâ”€â”€ App.css                 # å…¨å±€æ ·å¼
â”œâ”€â”€ MessageContent.tsx      # æ¶ˆæ¯å†…å®¹æ¸²æŸ“
â”œâ”€â”€ MessageContent.css      # æ¶ˆæ¯æ ·å¼
â”œâ”€â”€ main.tsx                # åº”ç”¨å…¥å£
â”œâ”€â”€ index.css               # åŸºç¡€æ ·å¼
â””â”€â”€ vite-env.d.ts          # Vite ç±»å‹å®šä¹‰
```

### æ¨¡å—èŒè´£

#### Components (ç»„ä»¶å±‚)
```typescript
// æ¯ä¸ªç»„ä»¶éµå¾ªä»¥ä¸‹ç»“æ„
Component/
  â”œâ”€â”€ index.tsx        // ç»„ä»¶é€»è¾‘
  â”œâ”€â”€ styles.css       // ç»„ä»¶æ ·å¼
  â””â”€â”€ types.ts         // ç»„ä»¶ç±»å‹ï¼ˆå¯é€‰ï¼‰

// ç»„ä»¶è®¾è®¡åŸåˆ™
- å•ä¸€èŒè´£
- Props ç±»å‹åŒ–
- ä½¿ç”¨ memo ä¼˜åŒ–
- ç‹¬ç«‹å¯æµ‹è¯•
```

#### Hooks (é€»è¾‘å±‚)
```typescript
// Hook å‘½åè§„èŒƒ: use + åŠŸèƒ½å
useChat      // èŠå¤©é€»è¾‘
useEngine    // å¼•æ“ç®¡ç†
useSession   // ä¼šè¯ç®¡ç†

// Hook è®¾è®¡åŸåˆ™
- å¯å¤ç”¨é€»è¾‘
- æ— å‰¯ä½œç”¨ï¼ˆçº¯å‡½æ•°ï¼‰
- æ¸…æ™°çš„è¾“å…¥è¾“å‡º
- å®Œæ•´çš„ç±»å‹å®šä¹‰
```

#### Utils (å·¥å…·å±‚)
```typescript
// å·¥å…·å‡½æ•°ç±»å‹
utils/
  â”œâ”€â”€ uid.ts           // é€šç”¨å·¥å…·
  â”œâ”€â”€ similarity.ts    // ç®—æ³•å·¥å…·
  â”œâ”€â”€ textQuality.ts   // ä¸šåŠ¡å·¥å…·
  â””â”€â”€ performance.ts   // æ€§èƒ½å·¥å…·

// å·¥å…·å‡½æ•°åŸåˆ™
- çº¯å‡½æ•°
- å•ä¸€èŒè´£
- å¯æµ‹è¯•
- æ–‡æ¡£å®Œæ•´
```

---

## ğŸ”„ æ ¸å¿ƒæ¨¡å—

### 1. èŠå¤©æ¨¡å—

#### ç»„ä»¶ç»“æ„

```
Chat System
â”œâ”€â”€ ChatHeader          (é¡¶éƒ¨å¯¼èˆª)
â”œâ”€â”€ ChatSidebar         (ä¼šè¯åˆ—è¡¨)
â”œâ”€â”€ ChatMessages        (æ¶ˆæ¯å±•ç¤º)
â””â”€â”€ ChatComposer        (æ¶ˆæ¯è¾“å…¥)
```

#### æ•°æ®æµ

```typescript
// å‘é€æ¶ˆæ¯æµç¨‹
ç”¨æˆ·è¾“å…¥
  â†“
ChatComposer.onSend()
  â†“
useChat.handleSend()
  â†“
â”œâ”€ éªŒè¯è¾“å…¥
â”œâ”€ åˆ›å»ºæ¶ˆæ¯å¯¹è±¡
â”œâ”€ æ›´æ–°ä¼šè¯
â””â”€ è°ƒç”¨ AI å¼•æ“
  â†“
æµå¼å“åº”å¤„ç†
  â†“
å®æ—¶æ›´æ–° UI
```

### 2. AI å¼•æ“æ¨¡å—

#### åŒå¼•æ“æ¶æ„

```typescript
// æµè§ˆå™¨æ¨¡å¼
useChat + WebLLM
  â†“
æœ¬åœ°æ¨ç†
  â†“
æµå¼è¾“å‡º

// è¿œç¨‹æ¨¡å¼
useRemoteChat + Fetch API
  â†“
API è¯·æ±‚
  â†“
æµå¼å“åº”
```

#### å¼•æ“ç®¡ç†

```typescript
// src/hooks/useEngine.ts
export function useEngine(
  engine: EngineMode,
  browserModel: string,
  downloadPaused: boolean
) {
  // å¼•æ“çŠ¶æ€
  const engineRef = useRef<MLCEngine | null>(null);
  const [engineReady, setEngineReady] = useState(false);
  const [progressText, setProgressText] = useState('');

  // åˆå§‹åŒ–é€»è¾‘
  useEffect(() => {
    if (engine === 'browser' && !downloadPaused) {
      initializeEngine();
    }
  }, [engine, browserModel, downloadPaused]);

  return {
    engineRef,
    engineReady,
    progressText,
    setProgressText,
  };
}
```

### 3. ä¼šè¯ç®¡ç†æ¨¡å—

#### ä¼šè¯æ•°æ®ç»“æ„

```typescript
interface Session {
  id: string;                    // å”¯ä¸€æ ‡è¯†
  title: string;                 // ä¼šè¯æ ‡é¢˜
  messages: Message[];           // æ¶ˆæ¯åˆ—è¡¨
  createdAt: number;             // åˆ›å»ºæ—¶é—´
  updatedAt: number;             // æ›´æ–°æ—¶é—´
}

interface SessionManager {
  sessions: Session[];           // æ‰€æœ‰ä¼šè¯
  currentSessionId: string;      // å½“å‰ä¼šè¯ID
}
```

#### ä¼šè¯æ“ä½œ

```typescript
// src/hooks/useSession.ts
export function useSession(
  sessionManager: SessionManager,
  setSessionManager: (sm: SessionManager) => void
) {
  // åˆ›å»ºä¼šè¯
  const createNewSession = useCallback(() => {
    const newSession: Session = {
      id: uid(),
      title: `å¯¹è¯ ${sessions.length + 1}`,
      messages: defaultMessages,
      createdAt: Date.now(),
      updatedAt: Date.now(),
    };
    
    setSessionManager({
      sessions: [...sessions, newSession],
      currentSessionId: newSession.id,
    });
  }, [sessions]);

  // åˆ‡æ¢ä¼šè¯
  const switchSession = useCallback((id: string) => {
    setSessionManager({
      ...sessionManager,
      currentSessionId: id,
    });
  }, [sessionManager]);

  // åˆ é™¤ä¼šè¯
  const deleteSession = useCallback((id: string) => {
    // å®ç°åˆ é™¤é€»è¾‘...
  }, [sessionManager]);

  return {
    currentSession,
    createNewSession,
    switchSession,
    deleteSession,
    updateCurrentSession,
  };
}
```

### 4. æ€§èƒ½ç›‘æ§æ¨¡å—

#### ç›‘æ§æŒ‡æ ‡

```typescript
// src/utils/performance.ts

// Web Vitals æ ¸å¿ƒæŒ‡æ ‡
interface WebVitalsMetric {
  name: 'FCP' | 'LCP' | 'FID' | 'CLS' | 'TTFB' | 'INP';
  value: number;
  rating: 'good' | 'needs-improvement' | 'poor';
}

// ç›‘æ§åŠŸèƒ½
export function monitorWebVitals() {
  // æ”¶é›† TTFB
  const ttfb = navigationTiming.responseStart - navigationTiming.requestStart;
  
  // æ”¶é›† FCP
  const paintEntries = performance.getEntriesByType('paint');
  
  // æ”¶é›† LCP
  const lcpObserver = new PerformanceObserver((list) => {
    // å¤„ç† LCP æ•°æ®
  });
}
```

---

## ğŸ“Š æ•°æ®æµ

### å®Œæ•´æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æ“ä½œ    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UI ç»„ä»¶     â”‚ â†’ onChange/onClick
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hook å±‚     â”‚ â†’ ä¸šåŠ¡é€»è¾‘å¤„ç†
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â†’ LocalStorage (æŒä¹…åŒ–)
       â”‚
       â”œâ”€â†’ WebLLM / API (AI æ¨ç†)
       â”‚
       â””â”€â†’ State Update (çŠ¶æ€æ›´æ–°)
              â”‚
              â†“
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  UI é‡æ¸²æŸ“   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶ˆæ¯å‘é€æµç¨‹

```typescript
// 1. ç”¨æˆ·è¾“å…¥
<ChatComposer 
  onSend={() => handleSend(input)}
/>

// 2. Hook å¤„ç†
const handleSend = useCallback(async (userMessage: string) => {
  // 2.1 åˆ›å»ºç”¨æˆ·æ¶ˆæ¯
  const userMsg: Message = {
    id: uid(),
    role: 'user',
    content: userMessage,
  };

  // 2.2 æ›´æ–°ä¼šè¯
  const updatedMessages = [...sessionMessages, userMsg];
  updateCurrentSession(updatedMessages);

  // 2.3 è°ƒç”¨ AI
  const assistantMsg: Message = {
    id: uid(),
    role: 'assistant',
    content: '',
  };
  updateCurrentSession([...updatedMessages, assistantMsg]);

  // 2.4 æµå¼å“åº”
  for await (const chunk of stream) {
    assistantMsg.content += chunk;
    updateCurrentSession([...updatedMessages, assistantMsg]);
  }
}, [sessionMessages]);

// 3. UI æ›´æ–°
{sessionMessages.map(msg => (
  <MessageItem key={msg.id} message={msg} />
))}
```

---

## ğŸ¨ è®¾è®¡æ¨¡å¼

### 1. ç»„ä»¶ç»„åˆæ¨¡å¼

```typescript
// å®¹å™¨ç»„ä»¶ + å±•ç¤ºç»„ä»¶
<ChatContainer>
  <ChatHeader {...headerProps} />
  <ChatMessages {...messagesProps} />
  <ChatComposer {...composerProps} />
</ChatContainer>

// ä¼˜ç‚¹:
// - å…³æ³¨ç‚¹åˆ†ç¦»
// - æ˜“äºæµ‹è¯•
// - å¯å¤ç”¨æ€§é«˜
```

### 2. Hook æ¨¡å¼

```typescript
// è‡ªå®šä¹‰ Hook å°è£…é€»è¾‘
function useChat(...) {
  const [loading, setLoading] = useState(false);
  
  const handleSend = useCallback(...);
  const handleStop = useCallback(...);
  
  return { loading, handleSend, handleStop };
}

// ä¼˜ç‚¹:
// - é€»è¾‘å¤ç”¨
// - æ˜“äºæµ‹è¯•
// - ä»£ç ç»„ç»‡æ¸…æ™°
```

### 3. çŠ¶æ€æå‡æ¨¡å¼

```typescript
// App ç»„ä»¶ç®¡ç†å…¨å±€çŠ¶æ€
function App() {
  const [sessionManager, setSessionManager] = useLocalStorage(...);
  const [engine, setEngine] = useLocalStorage(...);
  
  return (
    <ErrorBoundary>
      <ChatHeader {...props} />
      <ChatMessages {...props} />
    </ErrorBoundary>
  );
}
```

### 4. é”™è¯¯è¾¹ç•Œæ¨¡å¼

```typescript
// é”™è¯¯è¾¹ç•Œæ•è·å¼‚å¸¸
class ErrorBoundary extends Component {
  state = { hasError: false };
  
  static getDerivedStateFromError(error) {
    return { hasError: true };
  }
  
  componentDidCatch(error, errorInfo) {
    console.error(error, errorInfo);
  }
  
  render() {
    if (this.state.hasError) {
      return <ErrorUI />;
    }
    return this.props.children;
  }
}
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. React æ€§èƒ½ä¼˜åŒ–

```typescript
// ä½¿ç”¨ memo é¿å…é‡æ¸²æŸ“
const ChatMessage = memo(({ message }) => {
  return <div>{message.content}</div>;
});

// ä½¿ç”¨ useMemo ç¼“å­˜è®¡ç®—
const filteredMessages = useMemo(() => {
  return messages.filter(m => m.role !== 'system');
}, [messages]);

// ä½¿ç”¨ useCallback ç¼“å­˜å‡½æ•°
const handleClick = useCallback(() => {
  doSomething();
}, [dependency]);
```

### 2. ä»£ç åˆ†å‰²

```typescript
// vite.config.ts
manualChunks: (id) => {
  if (id.includes('react')) return 'react-core';
  if (id.includes('webllm')) return 'webllm';
  if (id.includes('markdown')) return 'markdown';
}

// æ‡’åŠ è½½
const Settings = lazy(() => import('./Settings'));
```

### 3. ç¼“å­˜ç­–ç•¥

```javascript
// Service Worker ç¼“å­˜
// é™æ€èµ„æº: ç¼“å­˜ä¼˜å…ˆ
// HTML: ç½‘ç»œä¼˜å…ˆï¼Œç¼“å­˜å¤‡ç”¨
// API: ä»…ç½‘ç»œ

const CACHE_CONFIG = {
  STATIC_MAX_AGE: 7 * 24 * 60 * 60 * 1000,   // 7å¤©
  DYNAMIC_MAX_AGE: 24 * 60 * 60 * 1000,      // 24å°æ—¶
  MAX_CACHE_ITEMS: 50,
};
```

---

## ğŸ”’ å®‰å…¨æ€§

### 1. XSS é˜²æŠ¤

```typescript
// ä½¿ç”¨ react-markdown å®‰å…¨æ¸²æŸ“
<ReactMarkdown
  remarkPlugins={[remarkGfm]}
  rehypePlugins={[rehypeHighlight]}
>
  {content}
</ReactMarkdown>

// é¿å… dangerouslySetInnerHTML
// âŒ <div dangerouslySetInnerHTML={{ __html: content }} />
// âœ… <ReactMarkdown>{content}</ReactMarkdown>
```

### 2. è¾“å…¥éªŒè¯

```typescript
// éªŒè¯ç”¨æˆ·è¾“å…¥
function validateInput(input: string): boolean {
  if (!input || input.trim().length === 0) {
    return false;
  }
  if (input.length > MAX_LENGTH) {
    return false;
  }
  return true;
}
```

### 3. API å¯†é’¥ä¿æŠ¤

```typescript
// ç¯å¢ƒå˜é‡å­˜å‚¨
const API_KEY = import.meta.env.VITE_REMOTE_API_KEY;

// ä¸åœ¨å®¢æˆ·ç«¯ç¡¬ç¼–ç 
// âŒ const API_KEY = 'sk-xxx';
// âœ… const API_KEY = import.meta.env.VITE_REMOTE_API_KEY;
```

---

## ğŸ“ˆ æ‰©å±•æ€§

### æ·»åŠ æ–°åŠŸèƒ½

```typescript
// 1. åˆ›å»ºæ–°ç»„ä»¶
src/components/NewFeature/
  â”œâ”€â”€ index.tsx
  â””â”€â”€ styles.css

// 2. åˆ›å»ºæ–° Hook
src/hooks/useNewFeature.ts

// 3. æ·»åŠ ç±»å‹
src/types/index.ts

// 4. é›†æˆåˆ° App
import NewFeature from './components/NewFeature';
```

### æ·»åŠ æ–°å¼•æ“

```typescript
// 1. å®šä¹‰å¼•æ“ç±»å‹
type EngineMode = 'browser' | 'remote' | 'new-engine';

// 2. åˆ›å»ºå¼•æ“ Hook
export function useNewEngine(...) {
  // å¼•æ“é€»è¾‘
}

// 3. é›†æˆåˆ° useChat
const chat = engine === 'new-engine' 
  ? useNewEngine(...) 
  : useChat(...);
```

---

## ğŸ” è°ƒè¯•æŒ‡å—

### å¼€å‘å·¥å…·

```typescript
// æ€§èƒ½åˆ†æ
window.getPerformanceSummary();

// React DevTools
// å®‰è£…æµè§ˆå™¨æ‰©å±•

// Vite è°ƒè¯•
// æ‰“å¼€ http://localhost:5177/__inspect/
```

### æ—¥å¿—ç³»ç»Ÿ

```typescript
// ç»Ÿä¸€æ—¥å¿—æ ¼å¼
console.log('[Module] Action:', data);

// å¼€å‘ç¯å¢ƒæ—¥å¿—
if (import.meta.env.DEV) {
  console.log('[DEBUG]', debug info);
}
```

---

<div align="center">

**ğŸ“š æŒç»­æ›´æ–°ä¸­...**

å¦‚æœ‰ç–‘é—®ï¼Œè¯·å‚è€ƒ [è´¡çŒ®æŒ‡å—](CONTRIBUTING.md)

</div>

